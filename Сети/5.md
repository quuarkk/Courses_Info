

### Конспект лекции: Маршрутизация, протоколы сетевого уровня и безопасность

---

#### **1. Основы маршрутизации**
- **Маршрутизатор** — устройство, передающее пакеты между сетями на основе IP-адресов.  
- **Таблица маршрутизации** (команда `show ip route`):  
  - Содержит пути к сетям (прямые и удаленные).  
  - **Прямые сети** (Connected) — автоматически добавляются при настройке IP-адресов на интерфейсах.  
  - **Статические маршруты** — настраиваются вручную (пример: `ip route 192.168.3.0 255.255.255.0 192.168.2.253`).  
  - **Динамические маршруты** — обновляются через протоколы (RIP, OSPF).  

---

#### **2. Протоколы сетевого уровня**
- **ICMP** (Internet Control Message Protocol):  
  - Используется для диагностики (`ping`, `traceroute`).  
  - Сообщения об ошибках (например, «Сеть недоступна»).  
- **ARP** (Address Resolution Protocol):  
  - Связывает IP-адреса с MAC-адресами.  
  - **ARP-таблица** — кэш соответствий (команда `arp -a`).  
  - **Gratuitous ARP** — широковещательный запрос для обновления ARP-таблиц других устройств.  

---

#### **3. Атаки на сетевой уровень**
- **ARP-спуфинг**:  
  - Злоумышленник подменяет MAC-адрес шлюза в ARP-таблицах.  
  - Перехват трафика (Man-in-the-Middle).  
  - **Защита**:  
    - **Port Security** на коммутаторах.  
    - Статические ARP-записи для критичных устройств.  
- **ICMP-атаки**:  
  - Заполнение сети ICMP-пакетами (DoS).  
  - **Защита**: фильтрация ICMP на фаерволах.  

---

#### **4. TTL (Time-to-Live)**
- Поле в IP-заголовке, ограничивающее время жизни пакета.  
- Уменьшается на 1 при прохождении каждого маршрутизатора.  
- **Цель**: предотвращение бесконечных петель маршрутизации.  

---

#### **5. Петли маршрутизации**
- Возникают из-за некорректных статических маршрутов или ошибок в динамической маршрутизации.  
- **Пример**: пакет бесконечно циркулирует между маршрутизаторами.  
- **Решение**:  
  - Настройка TTL.  
  - Использование протоколов динамической маршрутизации (OSPF, RIP), обнаруживающих петли.  

---

#### **6. Динамическая маршрутизация**
- **RIP** (Routing Information Protocol):  
  - Метрика — количество переходов (hop count).  
  - Обмен маршрутами каждые 30 секунд.  
- **OSPF** (Open Shortest Path First):  
  - Использует алгоритм Дейкстры для построения дерева кратчайших путей.  
  - Быстрое обновление маршрутов при изменениях в сети.  
- **Уязвимости**:  
  - Перехват трафика динамических протоколов (например, OSPF-пакеты).  
  - Подмена маршрутов злоумышленником.  

---

#### **7. Безопасность сетевого уровня**
- **Фильтрация трафика**:  
  - Блокировка ненужных протоколов (например, ICMP).  
  - Настройка ACL (Access Control Lists) на маршрутизаторах.  
- **Аутентификация маршрутизаторов**:  
  - Использование протоколов с шифрованием (OSPFv3 с IPsec).  
- **Мониторинг**:  
  - Анализ ARP-таблиц на наличие подмен.  
  - Трассировка маршрутов (`traceroute`) для выявления аномалий.  

---

**Ключевые термины**:  
- Маршрутизация, ARP-спуфинг, TTL, статический маршрут, OSPF, RIP, Port Security, ICMP, таблица маршрутизации.  

---

**Логические связи**:  
- Работа маршрутизаторов основана на таблицах маршрутизации, которые могут быть статическими или динамическими.  
- Протоколы ICMP и ARP обеспечивают базовую функциональность сетевого уровня, но уязвимы для атак.  
- TTL и динамическая маршрутизация решают проблему петель, но требуют дополнительных мер защиты.
